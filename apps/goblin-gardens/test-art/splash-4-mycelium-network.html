<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mycelium Network - Goblin Gardens Splash</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&family=Lora:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --anthropic-dark: #141413;
        --anthropic-light: #faf9f5;
        --anthropic-mid-gray: #b0aea5;
        --anthropic-light-gray: #e8e6dc;
        --anthropic-orange: #d97757;
        --anthropic-blue: #6a9bcc;
        --anthropic-green: #788c5d;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Poppins', sans-serif;
        background: linear-gradient(135deg, var(--anthropic-light) 0%, #f5f3ee 100%);
        min-height: 100vh;
        color: var(--anthropic-dark);
      }

      .container {
        display: flex;
        min-height: 100vh;
        padding: 20px;
        gap: 20px;
      }

      .sidebar {
        width: 320px;
        flex-shrink: 0;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        padding: 24px;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(20, 20, 19, 0.1);
        overflow-y: auto;
        overflow-x: hidden;
      }

      .sidebar h1 {
        font-family: 'Lora', serif;
        font-size: 24px;
        font-weight: 500;
        color: var(--anthropic-dark);
        margin-bottom: 8px;
      }

      .sidebar .subtitle {
        color: var(--anthropic-mid-gray);
        font-size: 14px;
        margin-bottom: 32px;
        line-height: 1.4;
      }

      .control-section {
        margin-bottom: 32px;
      }

      .control-section h3 {
        font-size: 16px;
        font-weight: 600;
        color: var(--anthropic-dark);
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .control-section h3::before {
        content: '•';
        color: var(--anthropic-orange);
        font-weight: bold;
      }

      .seed-input {
        width: 100%;
        background: var(--anthropic-light);
        padding: 12px;
        border-radius: 8px;
        font-family: 'Courier New', monospace;
        font-size: 14px;
        margin-bottom: 12px;
        border: 1px solid var(--anthropic-light-gray);
        text-align: center;
      }

      .seed-input:focus {
        outline: none;
        border-color: var(--anthropic-orange);
        box-shadow: 0 0 0 2px rgba(217, 119, 87, 0.1);
        background: white;
      }

      .seed-controls {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
        margin-bottom: 8px;
      }

      .control-group {
        margin-bottom: 20px;
      }

      .control-group label {
        display: block;
        font-size: 14px;
        font-weight: 500;
        color: var(--anthropic-dark);
        margin-bottom: 8px;
      }

      .slider-container {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .slider-container input[type='range'] {
        flex: 1;
        height: 4px;
        background: var(--anthropic-light-gray);
        border-radius: 2px;
        outline: none;
        -webkit-appearance: none;
      }

      .slider-container input[type='range']::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 16px;
        height: 16px;
        background: var(--anthropic-orange);
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .slider-container input[type='range']::-webkit-slider-thumb:hover {
        transform: scale(1.1);
        background: #c86641;
      }

      .slider-container input[type='range']::-moz-range-thumb {
        width: 16px;
        height: 16px;
        background: var(--anthropic-orange);
        border-radius: 50%;
        border: none;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .value-display {
        font-family: 'Courier New', monospace;
        font-size: 12px;
        color: var(--anthropic-mid-gray);
        min-width: 60px;
        text-align: right;
      }

      .button {
        background: var(--anthropic-orange);
        color: white;
        border: none;
        padding: 10px 16px;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        width: 100%;
      }

      .button:hover {
        background: #c86641;
        transform: translateY(-1px);
      }

      .button:active {
        transform: translateY(0);
      }

      .button.secondary {
        background: var(--anthropic-blue);
      }

      .button.secondary:hover {
        background: #5a8bb8;
      }

      .button.tertiary {
        background: var(--anthropic-green);
      }

      .button.tertiary:hover {
        background: #6b7b52;
      }

      .canvas-area {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 0;
      }

      #canvas-container {
        width: 100%;
        max-width: 1000px;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 20px 40px rgba(20, 20, 19, 0.1);
        background: white;
      }

      #canvas-container canvas {
        display: block;
        width: 100% !important;
        height: auto !important;
      }

      @media (max-width: 600px) {
        .container {
          flex-direction: column;
        }

        .sidebar {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="sidebar">
        <h1>Mycelium Network</h1>
        <div class="subtitle">
          Goblin Gardens Splash Screen #4 – Fungal threads spreading through the forest floor
        </div>

        <div class="control-section">
          <h3>Seed</h3>
          <input
            type="number"
            id="seed-input"
            class="seed-input"
            value="420"
            onchange="updateSeed()"
          />
          <div class="seed-controls">
            <button class="button secondary" onclick="previousSeed()">← Prev</button>
            <button class="button secondary" onclick="nextSeed()">Next →</button>
          </div>
          <button class="button tertiary" onclick="randomSeedAndUpdate()">↻ Random</button>
        </div>

        <div class="control-section">
          <h3>Parameters</h3>

          <div class="control-group">
            <label>Growth Speed</label>
            <div class="slider-container">
              <input
                type="range"
                id="growthSpeed"
                min="1"
                max="4"
                step="0.5"
                value="1"
                oninput="updateParam('growthSpeed', this.value)"
              />
              <span class="value-display" id="growthSpeed-value">5</span>
            </div>
          </div>

          <div class="control-group">
            <label>Branch Probability</label>
            <div class="slider-container">
              <input
                type="range"
                id="branchProb"
                min="0.05"
                max="0.075"
                step="0.05"
                value="0.01"
                oninput="updateParam('branchProb', this.value)"
              />
              <span class="value-display" id="branchProb-value">0.05</span>
            </div>
          </div>

          <div class="control-group">
            <label>Branch Angle</label>
            <div class="slider-container">
              <input
                type="range"
                id="branchAngle"
                min="10"
                max="60"
                step="5"
                value="30"
                oninput="updateParam('branchAngle', this.value)"
              />
              <span class="value-display" id="branchAngle-value">30</span>
            </div>
          </div>

          <div class="control-group">
            <label>Thread Thickness</label>
            <div class="slider-container">
              <input
                type="range"
                id="thickness"
                min="0.5"
                max="3.0"
                step="0.5"
                value="1.5"
                oninput="updateParam('thickness', this.value)"
              />
              <span class="value-display" id="thickness-value">1.5</span>
            </div>
          </div>

          <div class="control-group">
            <label>Spore Count</label>
            <div class="slider-container">
              <input
                type="range"
                id="sporeCount"
                min="0"
                max="50"
                step="5"
                value="5"
                oninput="updateParam('sporeCount', this.value)"
              />
              <span class="value-display" id="sporeCount-value">20</span>
            </div>
          </div>
        </div>

        <div class="control-section">
          <h3>Actions</h3>
          <button class="button" onclick="resetParameters()">Reset</button>
        </div>
      </div>

      <div class="canvas-area">
        <div id="canvas-container"></div>
      </div>
    </div>

    <script>
      let params = {
        seed: 420,
        growthSpeed: 5,
        branchProb: 0.05,
        branchAngle: 30,
        thickness: 1.5,
        sporeCount: 20,
      };

      let defaultParams = { ...params };

      let threads = [];
      let spores = [];
      let frameCounter = 0;

      function setup() {
        let canvas = createCanvas(1200, 1200);
        canvas.parent('canvas-container');
        initializeSystem();
      }

      function initializeSystem() {
        randomSeed(params.seed);
        noiseSeed(params.seed);

        threads = [];
        spores = [];
        frameCounter = 0;

        // Create initial mycelium threads
        for (let i = 0; i < 3; i++) {
          threads.push(
            new MyceliumThread(
              random(width * 0.3, width * 0.7),
              random(height * 0.3, height * 0.7),
              random(TWO_PI)
            )
          );
        }

        // Create spores
        for (let i = 0; i < params.sporeCount; i++) {
          spores.push(new Spore());
        }

        background(30, 25, 20); // Dark soil
      }

      function draw() {
        // Subtle fade for trails
        fill(30, 25, 20, 10);
        noStroke();
        rect(0, 0, width, height);

        frameCounter++;

        // Update and draw threads
        for (let i = 0; i < params.growthSpeed; i++) {
          for (let thread of threads) {
            thread.grow();
          }
        }

        for (let thread of threads) {
          thread.display();
        }

        // Update and draw spores
        for (let spore of spores) {
          spore.update();
          spore.display();
        }

        // Occasional new growth from spores
        if (frameCounter % 120 === 0 && threads.length < 50) {
          let spore = random(spores);
          if (spore && random() < 0.3) {
            threads.push(new MyceliumThread(spore.x, spore.y, random(TWO_PI)));
          }
        }
      }

      class MyceliumThread {
        constructor(x, y, angle) {
          this.segments = [];
          this.segments.push({ x: x, y: y });
          this.angle = angle;
          this.length = 0;
          this.maxLength = random(100, 300);
          this.growing = true;
          this.age = 0;
        }

        grow() {
          if (!this.growing || this.length >= this.maxLength) {
            this.growing = false;
            return;
          }

          // Add slight randomness to angle
          this.angle += random(-0.1, 0.1);

          // Calculate new position
          let lastSeg = this.segments[this.segments.length - 1];
          let newX = lastSeg.x + cos(this.angle) * 2;
          let newY = lastSeg.y + sin(this.angle) * 2;

          // Check bounds
          if (newX < 0 || newX > width || newY < 0 || newY > height) {
            this.growing = false;
            return;
          }

          this.segments.push({ x: newX, y: newY });
          this.length++;

          // Branch occasionally
          if (random() < params.branchProb && this.length > 20) {
            let branchAngle = this.angle + radians(random(-params.branchAngle, params.branchAngle));
            threads.push(new MyceliumThread(newX, newY, branchAngle));
          }

          this.age++;
        }

        display() {
          strokeWeight(params.thickness);
          noFill();

          for (let i = 0; i < this.segments.length - 1; i++) {
            let seg1 = this.segments[i];
            let seg2 = this.segments[i + 1];

            // Color gradient from old (brown) to new (glowing green-white)
            let segAge = map(i, 0, this.segments.length, 0, 1);
            let r, g, b, alpha;

            if (segAge < 0.7) {
              // Older segments - brown
              r = lerp(60, 100, segAge);
              g = lerp(45, 75, segAge);
              b = lerp(30, 50, segAge);
              alpha = 180;
            } else {
              // Newer segments - pale green glow
              r = lerp(100, 200, segAge);
              g = lerp(75, 220, segAge);
              b = lerp(50, 180, segAge);
              alpha = 220;
            }

            stroke(r, g, b, alpha);
            line(seg1.x, seg1.y, seg2.x, seg2.y);
          }

          // Draw node at branching points
          if (this.segments.length > 5 && random() < 0.1) {
            let node = random(this.segments);
            noStroke();
            fill(180, 200, 150, 150);
            circle(node.x, node.y, 4);
            fill(220, 240, 200, 100);
            circle(node.x, node.y, 8);
          }
        }
      }

      class Spore {
        constructor() {
          this.x = random(width);
          this.y = random(height);
          this.vx = random(-0.2, 0.2);
          this.vy = random(-0.2, 0.2);
          this.size = random(1, 3);
          this.alpha = random(100, 200);
        }

        update() {
          this.x += this.vx;
          this.y += this.vy;

          // Wrap around edges
          if (this.x < 0) this.x = width;
          if (this.x > width) this.x = 0;
          if (this.y < 0) this.y = height;
          if (this.y > height) this.y = 0;

          // Gentle drift
          this.vx += random(-0.05, 0.05);
          this.vy += random(-0.05, 0.05);
          this.vx = constrain(this.vx, -0.5, 0.5);
          this.vy = constrain(this.vy, -0.5, 0.5);
        }

        display() {
          noStroke();
          fill(200, 220, 180, this.alpha * 0.3);
          circle(this.x, this.y, this.size * 2);
          fill(220, 240, 200, this.alpha);
          circle(this.x, this.y, this.size);
        }
      }

      function updateParam(paramName, value) {
        params[paramName] = parseFloat(value);
        document.getElementById(paramName + '-value').textContent = value;

        if (paramName === 'sporeCount') {
          initializeSystem();
        }
      }

      function updateSeedDisplay() {
        document.getElementById('seed-input').value = params.seed;
      }

      function updateSeed() {
        let input = document.getElementById('seed-input');
        let newSeed = parseInt(input.value);
        if (newSeed && newSeed > 0) {
          params.seed = newSeed;
          initializeSystem();
        } else {
          updateSeedDisplay();
        }
      }

      function previousSeed() {
        params.seed = Math.max(1, params.seed - 1);
        updateSeedDisplay();
        initializeSystem();
      }

      function nextSeed() {
        params.seed = params.seed + 1;
        updateSeedDisplay();
        initializeSystem();
      }

      function randomSeedAndUpdate() {
        params.seed = Math.floor(Math.random() * 999999) + 1;
        updateSeedDisplay();
        initializeSystem();
      }

      function resetParameters() {
        params = { ...defaultParams };

        document.getElementById('growthSpeed').value = params.growthSpeed;
        document.getElementById('growthSpeed-value').textContent = params.growthSpeed;
        document.getElementById('branchProb').value = params.branchProb;
        document.getElementById('branchProb-value').textContent = params.branchProb;
        document.getElementById('branchAngle').value = params.branchAngle;
        document.getElementById('branchAngle-value').textContent = params.branchAngle;
        document.getElementById('thickness').value = params.thickness;
        document.getElementById('thickness-value').textContent = params.thickness;
        document.getElementById('sporeCount').value = params.sporeCount;
        document.getElementById('sporeCount-value').textContent = params.sporeCount;

        updateSeedDisplay();
        initializeSystem();
      }

      window.addEventListener('load', function () {
        updateSeedDisplay();
      });
    </script>
  </body>
</html>
