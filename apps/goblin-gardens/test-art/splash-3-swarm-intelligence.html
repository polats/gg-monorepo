<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Swarm Intelligence - Goblin Gardens Splash</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&family=Lora:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --anthropic-dark: #141413;
        --anthropic-light: #faf9f5;
        --anthropic-mid-gray: #b0aea5;
        --anthropic-light-gray: #e8e6dc;
        --anthropic-orange: #d97757;
        --anthropic-blue: #6a9bcc;
        --anthropic-green: #788c5d;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Poppins', sans-serif;
        background: linear-gradient(135deg, var(--anthropic-light) 0%, #f5f3ee 100%);
        min-height: 100vh;
        color: var(--anthropic-dark);
      }

      .container {
        display: flex;
        min-height: 100vh;
        padding: 20px;
        gap: 20px;
      }

      .sidebar {
        width: 320px;
        flex-shrink: 0;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        padding: 24px;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(20, 20, 19, 0.1);
        overflow-y: auto;
        overflow-x: hidden;
      }

      .sidebar h1 {
        font-family: 'Lora', serif;
        font-size: 24px;
        font-weight: 500;
        color: var(--anthropic-dark);
        margin-bottom: 8px;
      }

      .sidebar .subtitle {
        color: var(--anthropic-mid-gray);
        font-size: 14px;
        margin-bottom: 32px;
        line-height: 1.4;
      }

      .control-section {
        margin-bottom: 32px;
      }

      .control-section h3 {
        font-size: 16px;
        font-weight: 600;
        color: var(--anthropic-dark);
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .control-section h3::before {
        content: '•';
        color: var(--anthropic-orange);
        font-weight: bold;
      }

      .seed-input {
        width: 100%;
        background: var(--anthropic-light);
        padding: 12px;
        border-radius: 8px;
        font-family: 'Courier New', monospace;
        font-size: 14px;
        margin-bottom: 12px;
        border: 1px solid var(--anthropic-light-gray);
        text-align: center;
      }

      .seed-input:focus {
        outline: none;
        border-color: var(--anthropic-orange);
        box-shadow: 0 0 0 2px rgba(217, 119, 87, 0.1);
        background: white;
      }

      .seed-controls {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
        margin-bottom: 8px;
      }

      .control-group {
        margin-bottom: 20px;
      }

      .control-group label {
        display: block;
        font-size: 14px;
        font-weight: 500;
        color: var(--anthropic-dark);
        margin-bottom: 8px;
      }

      .slider-container {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .slider-container input[type='range'] {
        flex: 1;
        height: 4px;
        background: var(--anthropic-light-gray);
        border-radius: 2px;
        outline: none;
        -webkit-appearance: none;
      }

      .slider-container input[type='range']::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 16px;
        height: 16px;
        background: var(--anthropic-orange);
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .slider-container input[type='range']::-webkit-slider-thumb:hover {
        transform: scale(1.1);
        background: #c86641;
      }

      .slider-container input[type='range']::-moz-range-thumb {
        width: 16px;
        height: 16px;
        background: var(--anthropic-orange);
        border-radius: 50%;
        border: none;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .value-display {
        font-family: 'Courier New', monospace;
        font-size: 12px;
        color: var(--anthropic-mid-gray);
        min-width: 60px;
        text-align: right;
      }

      .button {
        background: var(--anthropic-orange);
        color: white;
        border: none;
        padding: 10px 16px;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        width: 100%;
      }

      .button:hover {
        background: #c86641;
        transform: translateY(-1px);
      }

      .button:active {
        transform: translateY(0);
      }

      .button.secondary {
        background: var(--anthropic-blue);
      }

      .button.secondary:hover {
        background: #5a8bb8;
      }

      .button.tertiary {
        background: var(--anthropic-green);
      }

      .button.tertiary:hover {
        background: #6b7b52;
      }

      .canvas-area {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 0;
      }

      #canvas-container {
        width: 100%;
        max-width: 1000px;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 20px 40px rgba(20, 20, 19, 0.1);
        background: white;
      }

      #canvas-container canvas {
        display: block;
        width: 100% !important;
        height: auto !important;
      }

      @media (max-width: 600px) {
        .container {
          flex-direction: column;
        }

        .sidebar {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="sidebar">
        <h1>Swarm Intelligence</h1>
        <div class="subtitle">
          Goblin Gardens Splash Screen #3 – Hundreds of goblins moving as one chaotic swarm
        </div>

        <div class="control-section">
          <h3>Seed</h3>
          <input
            type="number"
            id="seed-input"
            class="seed-input"
            value="1337"
            onchange="updateSeed()"
          />
          <div class="seed-controls">
            <button class="button secondary" onclick="previousSeed()">← Prev</button>
            <button class="button secondary" onclick="nextSeed()">Next →</button>
          </div>
          <button class="button tertiary" onclick="randomSeedAndUpdate()">↻ Random</button>
        </div>

        <div class="control-section">
          <h3>Parameters</h3>

          <div class="control-group">
            <label>Goblin Count</label>
            <div class="slider-container">
              <input
                type="range"
                id="goblinCount"
                min="50"
                max="300"
                step="25"
                value="150"
                oninput="updateParam('goblinCount', this.value)"
              />
              <span class="value-display" id="goblinCount-value">150</span>
            </div>
          </div>

          <div class="control-group">
            <label>Cohesion</label>
            <div class="slider-container">
              <input
                type="range"
                id="cohesion"
                min="0.1"
                max="2.0"
                step="0.1"
                value="1.0"
                oninput="updateParam('cohesion', this.value)"
              />
              <span class="value-display" id="cohesion-value">1.0</span>
            </div>
          </div>

          <div class="control-group">
            <label>Separation</label>
            <div class="slider-container">
              <input
                type="range"
                id="separation"
                min="0.5"
                max="3.0"
                step="0.5"
                value="1.5"
                oninput="updateParam('separation', this.value)"
              />
              <span class="value-display" id="separation-value">1.5</span>
            </div>
          </div>

          <div class="control-group">
            <label>Alignment</label>
            <div class="slider-container">
              <input
                type="range"
                id="alignment"
                min="0.1"
                max="2.0"
                step="0.1"
                value="1.0"
                oninput="updateParam('alignment', this.value)"
              />
              <span class="value-display" id="alignment-value">1.0</span>
            </div>
          </div>

          <div class="control-group">
            <label>Max Speed</label>
            <div class="slider-container">
              <input
                type="range"
                id="maxSpeed"
                min="1"
                max="6"
                step="0.5"
                value="3"
                oninput="updateParam('maxSpeed', this.value)"
              />
              <span class="value-display" id="maxSpeed-value">3</span>
            </div>
          </div>

          <div class="control-group">
            <label>Perception Radius</label>
            <div class="slider-container">
              <input
                type="range"
                id="perceptionRadius"
                min="20"
                max="100"
                step="10"
                value="50"
                oninput="updateParam('perceptionRadius', this.value)"
              />
              <span class="value-display" id="perceptionRadius-value">50</span>
            </div>
          </div>
        </div>

        <div class="control-section">
          <h3>Actions</h3>
          <button class="button" onclick="resetParameters()">Reset</button>
        </div>
      </div>

      <div class="canvas-area">
        <div id="canvas-container"></div>
      </div>
    </div>

    <script>
      let params = {
        seed: 1337,
        goblinCount: 150,
        cohesion: 1.0,
        separation: 1.5,
        alignment: 1.0,
        maxSpeed: 3,
        perceptionRadius: 50,
      };

      let defaultParams = { ...params };

      let goblins = [];
      let lootPoints = [];
      let frameCounter = 0;

      function setup() {
        let canvas = createCanvas(1200, 1200);
        canvas.parent('canvas-container');
        initializeSystem();
      }

      function initializeSystem() {
        randomSeed(params.seed);
        noiseSeed(params.seed);

        goblins = [];
        lootPoints = [];
        frameCounter = 0;

        // Create goblins
        for (let i = 0; i < params.goblinCount; i++) {
          goblins.push(new Goblin());
        }

        // Create initial loot points
        for (let i = 0; i < 3; i++) {
          lootPoints.push(createLootPoint());
        }

        background(25, 30, 20); // Dark forest floor
      }

      function createLootPoint() {
        return {
          x: random(100, width - 100),
          y: random(100, height - 100),
          life: random(200, 400),
        };
      }

      function draw() {
        // Dark background with fade
        fill(25, 30, 20, 20);
        noStroke();
        rect(0, 0, width, height);

        frameCounter++;

        // Update loot points
        for (let i = lootPoints.length - 1; i >= 0; i--) {
          lootPoints[i].life--;
          if (lootPoints[i].life <= 0) {
            lootPoints.splice(i, 1);
          }
        }

        // Add new loot points occasionally
        if (frameCounter % 100 === 0 && lootPoints.length < 4) {
          lootPoints.push(createLootPoint());
        }

        // Draw loot points
        for (let loot of lootPoints) {
          let alpha = map(loot.life % 60, 0, 60, 100, 255);
          noStroke();
          fill(255, 215, 0, alpha * 0.3);
          circle(loot.x, loot.y, 40);
          fill(255, 215, 0, alpha);
          circle(loot.x, loot.y, 15);
        }

        // Update and draw goblins
        for (let goblin of goblins) {
          goblin.flock(goblins);
          goblin.seekLoot(lootPoints);
          goblin.update();
          goblin.edges();
          goblin.display();
        }
      }

      class Goblin {
        constructor() {
          this.pos = createVector(random(width), random(height));
          this.vel = p5.Vector.random2D();
          this.vel.setMag(random(1, 3));
          this.acc = createVector(0, 0);
          this.maxForce = 0.2;
          this.size = random(3, 5);
        }

        flock(goblins) {
          let alignment = this.align(goblins);
          let cohesion = this.cohere(goblins);
          let separation = this.separate(goblins);

          alignment.mult(params.alignment);
          cohesion.mult(params.cohesion);
          separation.mult(params.separation);

          this.acc.add(alignment);
          this.acc.add(cohesion);
          this.acc.add(separation);
        }

        align(goblins) {
          let steering = createVector(0, 0);
          let total = 0;
          for (let other of goblins) {
            let d = dist(this.pos.x, this.pos.y, other.pos.x, other.pos.y);
            if (other !== this && d < params.perceptionRadius) {
              steering.add(other.vel);
              total++;
            }
          }
          if (total > 0) {
            steering.div(total);
            steering.setMag(params.maxSpeed);
            steering.sub(this.vel);
            steering.limit(this.maxForce);
          }
          return steering;
        }

        cohere(goblins) {
          let steering = createVector(0, 0);
          let total = 0;
          for (let other of goblins) {
            let d = dist(this.pos.x, this.pos.y, other.pos.x, other.pos.y);
            if (other !== this && d < params.perceptionRadius) {
              steering.add(other.pos);
              total++;
            }
          }
          if (total > 0) {
            steering.div(total);
            steering.sub(this.pos);
            steering.setMag(params.maxSpeed);
            steering.sub(this.vel);
            steering.limit(this.maxForce);
          }
          return steering;
        }

        separate(goblins) {
          let steering = createVector(0, 0);
          let total = 0;
          for (let other of goblins) {
            let d = dist(this.pos.x, this.pos.y, other.pos.x, other.pos.y);
            if (other !== this && d < params.perceptionRadius / 2) {
              let diff = p5.Vector.sub(this.pos, other.pos);
              diff.div(d * d);
              steering.add(diff);
              total++;
            }
          }
          if (total > 0) {
            steering.div(total);
            steering.setMag(params.maxSpeed);
            steering.sub(this.vel);
            steering.limit(this.maxForce);
          }
          return steering;
        }

        seekLoot(lootPoints) {
          if (lootPoints.length === 0) return;

          // Find nearest loot
          let nearest = lootPoints[0];
          let minDist = dist(this.pos.x, this.pos.y, nearest.x, nearest.y);
          for (let loot of lootPoints) {
            let d = dist(this.pos.x, this.pos.y, loot.x, loot.y);
            if (d < minDist) {
              minDist = d;
              nearest = loot;
            }
          }

          // Seek towards it
          let desired = createVector(nearest.x - this.pos.x, nearest.y - this.pos.y);
          desired.setMag(params.maxSpeed);
          let steer = p5.Vector.sub(desired, this.vel);
          steer.limit(this.maxForce);
          steer.mult(0.3); // Reduced influence
          this.acc.add(steer);
        }

        update() {
          this.vel.add(this.acc);
          this.vel.limit(params.maxSpeed);
          this.pos.add(this.vel);
          this.acc.mult(0);
        }

        edges() {
          if (this.pos.x > width) this.pos.x = 0;
          if (this.pos.x < 0) this.pos.x = width;
          if (this.pos.y > height) this.pos.y = 0;
          if (this.pos.y < 0) this.pos.y = height;
        }

        display() {
          // Calculate density (how many neighbors)
          let neighbors = 0;
          for (let other of goblins) {
            let d = dist(this.pos.x, this.pos.y, other.pos.x, other.pos.y);
            if (other !== this && d < params.perceptionRadius / 2) {
              neighbors++;
            }
          }

          // Color based on density
          let density = constrain(neighbors / 10, 0, 1);
          let r = lerp(80, 180, density);
          let g = lerp(100, 220, density);
          let b = lerp(50, 100, density);

          noStroke();
          fill(r, g, b, 180);
          circle(this.pos.x, this.pos.y, this.size);

          // Trail effect
          fill(r, g, b, 30);
          circle(this.pos.x - this.vel.x, this.pos.y - this.vel.y, this.size * 0.7);
        }
      }

      function updateParam(paramName, value) {
        params[paramName] = parseFloat(value);
        document.getElementById(paramName + '-value').textContent = value;

        if (paramName === 'goblinCount') {
          initializeSystem();
        }
      }

      function updateSeedDisplay() {
        document.getElementById('seed-input').value = params.seed;
      }

      function updateSeed() {
        let input = document.getElementById('seed-input');
        let newSeed = parseInt(input.value);
        if (newSeed && newSeed > 0) {
          params.seed = newSeed;
          initializeSystem();
        } else {
          updateSeedDisplay();
        }
      }

      function previousSeed() {
        params.seed = Math.max(1, params.seed - 1);
        updateSeedDisplay();
        initializeSystem();
      }

      function nextSeed() {
        params.seed = params.seed + 1;
        updateSeedDisplay();
        initializeSystem();
      }

      function randomSeedAndUpdate() {
        params.seed = Math.floor(Math.random() * 999999) + 1;
        updateSeedDisplay();
        initializeSystem();
      }

      function resetParameters() {
        params = { ...defaultParams };

        document.getElementById('goblinCount').value = params.goblinCount;
        document.getElementById('goblinCount-value').textContent = params.goblinCount;
        document.getElementById('cohesion').value = params.cohesion;
        document.getElementById('cohesion-value').textContent = params.cohesion;
        document.getElementById('separation').value = params.separation;
        document.getElementById('separation-value').textContent = params.separation;
        document.getElementById('alignment').value = params.alignment;
        document.getElementById('alignment-value').textContent = params.alignment;
        document.getElementById('maxSpeed').value = params.maxSpeed;
        document.getElementById('maxSpeed-value').textContent = params.maxSpeed;
        document.getElementById('perceptionRadius').value = params.perceptionRadius;
        document.getElementById('perceptionRadius-value').textContent = params.perceptionRadius;

        updateSeedDisplay();
        initializeSystem();
      }

      window.addEventListener('load', function () {
        updateSeedDisplay();
      });
    </script>
  </body>
</html>
